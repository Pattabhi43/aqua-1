name: Complete Workflow

on:
  push:
    branches: ["main"]
  pull_request:
    branches: ["main"]

jobs:
  build:
    runs-on: self-hosted
    steps:
      - uses: actions/checkout@v3

      - name: Installing dependencies
        run: |
          echo "The processes are installing in sequential order"
          sudo apt update -y
          sudo apt install git -y
          sudo apt install python3-pip -y
          pip install pywinrm

      - name: Install ansible
        run: |
          echo "Ansible installation starts"
          sudo apt-get update && sudo apt-get install software-properties-common -y && sudo apt-add-repository --yes --update ppa:ansible/ansible
          if ! ansible --version >/dev/null 2>&1; then
            echo "Ansible not installed. Workflow stopped"
          else
            echo "Ansible is installed"
          fi

      - name: Checking ansible ping and running playbook
        run: |
          ansible -m localhost ping
          ansible-playbook docker-create.yaml
          if ! docker --version >/dev/null 2>&1; then
            echo "Playbook failed"
          else
            echo "Docker installation completed"
          fi

